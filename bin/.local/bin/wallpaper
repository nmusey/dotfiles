#!/usr/bin/env bash

WALLPAPER_DIR="$HOME/wallpapers"
SYMLINK="$WALLPAPER_DIR/wallpaper.jpg"

choices=$(find "$WALLPAPER_DIR" -maxdepth 1 -type f \
  \( -iname "*.jpg" -o -iname "*.png" \) \
  ! -samefile "$SYMLINK" \
  -exec basename {} \;)

selected=$(echo "$choices" | rofi -dmenu -p "Choose wallpaper")
[ -z "$selected" ] && exit 1

new_wall="$WALLPAPER_DIR/$selected"
rm -f "$SYMLINK"
ln -s "$new_wall" "$SYMLINK"
hellwal --neon-mode --check-contrast -i "$new_wall"

hyprctl dispatch exec "pkill hyprpaper && hyprpaper"
hyprctl dispatch exec "hyprpaper"
hyprctl reload

if command -v waybar &>/dev/null; then
    pkill waybar;
    waybar &
fi

if command -v hyprpanel &>/dev/null; then
    pkill hyprpanel;
    hyprpanel &
fi

if command -v openrgb &>/dev/null && [[ -f ~/.cache/wal/colors.sh ]] ; then 
    source ~/.cache/wal/colors.sh
    openrgb --color ${color1:1}
fi
